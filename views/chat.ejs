<h1>Atendimento para <span id="chat-number">Nenhum cliente</span></h1>

<div id="messages">
  <% Object.values(messages).forEach(msg => { %>
    <div class="message <%= msg.sender === 'Você' ? 'my-message' : '' %>">
      <span class="sender"><%= msg.sender %>:</span>
      <span class="text"><%= msg.text %></span>
    </div>
  <% }) %>
</div>

<% if (Object.values(messages).length > 0) { %>
  <div class="chat-input">
    <input type="hidden" id="chat-number-hidden" value="">
    <textarea id="messageInput" placeholder="Digite a mensagem..." rows="3"></textarea>
    <button onclick="sendMessage()">Enviar</button>
  </div>
<% } %>

<script>
  async function sendMessage() {
    try {
      const message = document.getElementById("messageInput").value;
      const number = document.getElementById("chat-number-hidden").value;
      
      if (!number || !message) return alert("Selecione um cliente!");

      const response = await fetch("/send", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ number, message })
      });

      if (!response.ok) {
        const errorData = await response.json();
        throw new Error(errorData.error || "Erro ao enviar mensagem.");
      }

      document.getElementById("messages").innerHTML += `
        <div class="message my-message">
          <span class="sender">Você:</span>
          <span class="text">${message}</span>
        </div>
      `;
      document.getElementById("messageInput").value = "";
    } catch (e) {
      alert("Erro: " + e.message);
    }
  }
</script>
